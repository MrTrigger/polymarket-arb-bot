# Strategy Configuration
# ======================
#
# Tunable strategy parameters for the trading bot.
# See config/bot.toml for operational settings.

# ============================================================================
# USER SETTINGS - Tune these for optimization
# ============================================================================

[tuning]
# Allocation ratios for directional signals (0.0 to 1.0)
# Higher = more aggressive on signal direction
strong_up_ratio = 0.82    # Strong UP: 82% YES, 18% NO
lean_up_ratio = 0.65      # Lean UP: 65% YES, 35% NO

# Phase confidence thresholds (0.0 to 1.0)
# Lower = more trades, higher risk
early_threshold = 0.80    # >10 min remaining
build_threshold = 0.60    # 5-10 min remaining
core_threshold = 0.50     # 2-5 min remaining
final_threshold = 0.40    # <2 min remaining

# EV-based mode settings
# Trade if: (confidence - price) >= min_edge
# min_edge decays from max_edge_factor at window start to 0 at end
max_edge_factor = 0.08    # 8% EV required at window start (sweep optimal)

# Confidence calculation params (EV-based mode)
# time_conf = time_conf_floor + (1 - time_conf_floor) * (1 - time_ratio)
# dist_conf = clamp(dist_conf_floor + dist_conf_per_atr * atr_multiple, floor, 1.0)
time_conf_floor = 0.30    # Min confidence from time at window start
dist_conf_floor = 0.15    # Min confidence for tiny moves (sweep optimal)
dist_conf_per_atr = 0.30  # Confidence gained per ATR of movement (sweep optimal)

[sweep]
# Parameter sweep configuration
# Run: cargo run -p poly-bot --release -- --mode backtest
#
# EV-based mode: sweep edge_factors and confidence params
# Legacy phase mode: set max_edge_factor = 0 and sweep thresholds

# Always swept
#strong_ratios = [0.75, 0.78, 0.80, 0.82, 0.85, 0.88, 0.90]
#lean_ratios = [0.55, 0.60, 0.65, 0.70]

# EV-based mode sweep (minimum EV required at window start)
# Narrowed based on first sweep - lower values performed similarly
edge_factors = [0.02, 0.05, 0.08]

# Confidence calculation params sweep
# Results from 54-run sweep (2026-01-10 to 2026-01-12, BTC):
# - dist_conf_floor: 0.15 best (avg $5272 vs $5057 for 0.05)
# - dist_conf_per_atr: 0.30 best (avg $5217)
# - max_edge_factor: 0.08 best (avg $5197, highest peak $5748)
# - time_conf_floor: minimal impact (0.25 slightly better avg)
time_conf_floors = [0.25, 0.30]
dist_conf_floors = [0.05, 0.10, 0.15]
dist_conf_per_atrs = [0.25, 0.30, 0.35]

# Legacy phase mode sweep (uncomment and set max_edge_factor = 0)
# early_thresholds = [0.75, 0.80, 0.85]
# final_thresholds = [0.35, 0.40, 0.45]

results_file = "sweep_results.json"

# ============================================================================
# DEFAULTS - Rarely need to change these
# ============================================================================

[phases]
# Phase time boundaries (minutes)
early_boundary_min = 10
build_boundary_min = 5
core_boundary_min = 2

# Budget allocation per phase (must sum to 1.0)
early_budget = 0.15
build_budget = 0.25
core_budget = 0.30
final_budget = 0.30

[signals]
# Signal thresholds (basis points from strike)
strong_threshold_base_bps = 30
lean_threshold_base_bps = 20

# Time scaling factors
time_scale_30min = 1.0
time_scale_10min = 0.7
time_scale_3min = 0.5
time_scale_late = 0.3

[confidence]
# ATR normalization per asset
default_atr_btc = 20.0
default_atr_eth = 1.0
default_atr_sol = 0.15

# Distance confidence thresholds (ATR multiples)
dist_very_high_atr = 1.5
dist_high_atr = 1.0
dist_medium_atr = 0.75
dist_low_atr = 0.50
dist_very_low_atr = 0.25

# Time confidence thresholds (minutes)
time_very_high_min = 3
time_high_min = 6
time_medium_min = 9
time_low_min = 12

# Confidence boost for strong signals
dual_strong_boost = 1.2

[sizing]
trades_per_phase = 15
min_confidence_multiplier = 0.5
max_confidence_multiplier = 2.0
max_single_side_exposure = 0.80
min_hedge_ratio = 0.20
min_order_size = 1.0
