# Polymarket Bot Config - 15-MINUTE MARKETS (WITH FEES)
# ======================================================
#
# 15-minute markets have taker fees (~1.5-2.5% depending on price).
# Higher margin thresholds required to overcome fee drag.
# Makers earn rebates, so limit orders preferred.
#
# Usage:
#   cargo run -p poly-bot --release -- --config config/15min.toml --mode backtest
#   cargo run -p poly-bot --release -- --config config/15min.toml --mode live

[general]
mode = "live"
assets = ["BTC", "ETH", "SOL", "XRP"]
window_duration = "15min"
console_log_level = "warn"
file_log_level = "info"

[trading]
max_market_exposure = 250.0
max_total_exposure = 1000.0
base_order_size = 10.0
available_balance = 1000.0

# 15-MIN PHASE THRESHOLDS (900 seconds total)
# - Early: >300s remaining (>5 min)
# - Mid: 120-300s remaining (2-5 min)
# - Late: <120s remaining (<2 min)
early_threshold_secs = 300
mid_threshold_secs = 120
min_time_remaining_secs = 30

# HIGHER MARGINS - MUST BEAT ~2-3% TAKER FEES
min_margin_early_pct = 4.0 # 4.0% for early phase
min_margin_mid_pct = 3.0   # 3.0% for mid phase
min_margin_late_pct = 2.0  # 2.0% for late phase (still above fees)

[risk]
max_daily_loss = 200.0
emergency_close_threshold = 0.15
risk_mode = "directional"
max_consecutive_failures = 3
circuit_breaker_cooldown_secs = 300

[execution]
# LIMIT ORDERS PREFERRED - earn rebates instead of paying fees
execution_mode = "market"
chase_enabled = true
chase_step_size = 0.01
chase_check_interval_ms = 500
max_chase_time_ms = 5000

[engines]
priority = ["directional", "arbitrage", "maker"]

[engines.arbitrage]
# Usually not viable due to fees eating margins
enabled = false
min_margin_early_bps = 400 # 4.0% - need high edge
min_margin_mid_bps = 300   # 3.0%
min_margin_late_bps = 200  # 2.0%

[engines.directional]
enabled = true
min_seconds_remaining = 60
max_combined_cost = 1.02
max_spread_bps = 1500
min_favorable_depth = 50.0

strong_threshold_late_bps = 9
lean_threshold_late_bps = 6

# Optimal values from sweep (20h L2 data, Jan 26-27)
# Best risk-adjusted: 160.5% return / 23.9% DD / Ret/DD ratio 6.7x
max_edge_factor = 0.04
time_conf_floor = 0.20
dist_conf_per_atr = 0.50

[engines.maker]
# Market making can work since makers earn rebates
enabled = false
min_seconds_remaining = 120
min_spread_bps = 100

[backtest]
data_dir = "analysis/session_2026-02-09T12-19"
speed = 0.0
sweep_enabled = true
fill_delay_ms = 500
# book_interval_ms = 1000  # Data already pre-downsampled to 1s

[backtest.trading]
available_balance = 1000.0
max_market_exposure = 250.0
max_total_exposure = 1000.0
base_order_size = 10.0

[backtest.sweep]
# Re-sweep with 500ms fill delay to find optimal params under realistic latency
# Fix time_conf at best known value, sweep edge and dist_conf
edge_factors = [0.01, 0.03, 0.05]
time_conf_floors = [0.20]
dist_conf_per_atrs = [0.40, 0.60, 0.80]

[oracle]
chainlink_stale_threshold_secs = 30
binance_lead_enabled = true
lead_confirm_boost = 0.15
lead_oppose_cut = 0.25

[observability]
capture_decisions = true
capture_counterfactuals = true
detect_anomalies = true

[dashboard]
enabled = true
websocket_port = 3001
api_port = 3002
