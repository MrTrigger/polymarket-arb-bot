# Polymarket Arbitrage Bot Configuration
# ========================================
#
# Environment variables (set in .env or shell):
#   POLY_PRIVATE_KEY    - Wallet private key for signing transactions
#   POLY_API_KEY        - Polymarket API key
#   POLY_API_SECRET     - Polymarket API secret
#   POLY_API_PASSPHRASE - Polymarket API passphrase
#   CLICKHOUSE_URL      - ClickHouse HTTP URL (optional, for observability)
#   CLICKHOUSE_USER     - ClickHouse username
#   CLICKHOUSE_PASSWORD - ClickHouse password
#
# Usage:
#   cargo run -p poly-bot --release -- --mode paper
#   cargo run -p poly-bot --release -- --mode live

# ============================================================================
# REQUIRED SETTINGS - You MUST configure all of these (10 fields)
# ============================================================================

[general]
# REQUIRED: Operating mode
#   "paper"    - Simulated trading with real market data
#   "live"     - Real trading with real money
#   "backtest" - Historical data replay
mode = "live"

# REQUIRED: Crypto assets to trade
#   Available: "BTC", "ETH", "SOL", "XRP"
assets = ["BTC", "ETH", "SOL", "XRP"]         # ["BTC"] ["BTC", "ETH", "SOL", "XRP"]

# REQUIRED: Market window duration
#   "15min" - 15-minute binary options (higher frequency)
#   "1h"    - 1-hour binary options
window_duration = "15min"

# optional: Console logging verbosity: "error", "warn", "info", "debug", "trace"
console_log_level = "info"

# optional: File logging verbosity: "error", "warn", "info", "debug", "trace"
file_log_level = "debug"

[trading]
# REQUIRED: Maximum exposure per market in USDC
#   Hard cap on position size for a single market
max_market_exposure = 250.0

# REQUIRED: Maximum total exposure across ALL markets in USDC
#   Hard cap on total capital at risk at any time
max_total_exposure = 1000.0

# REQUIRED: Base order size in USDC
#   Target size for each order (both arb and directional)
#   Polymarket minimum is ~$5 worth of shares
base_order_size = 8.0

# REQUIRED: Total trading capital available in USDC
#   Used for allowance management in live mode
available_balance = 1000.0

[risk]
# REQUIRED: Maximum daily loss before trading stops (USDC)
#   Circuit breaker triggers when daily P&L drops below this
max_daily_loss = 200.0

# REQUIRED: Emergency close threshold (ratio)
#   Close all positions if loss exceeds this % of balance
#   0.15 = 15% loss triggers emergency close
emergency_close_threshold = 0.15

[execution]
# REQUIRED: Order execution mode
#   "limit"  - Maker orders (lower fees, may not fill)
#   "market" - Taker orders (instant fill, higher fees)
execution_mode = "market"

# optional: Enable price chasing for unfilled limit orders
# WARNING: Can block event loop - usually keep disabled
chase_enabled = false

# optional: Price step for chasing (must match Polymarket tick size)
chase_step_size = 0.01

# optional: Milliseconds between order status checks during chase
chase_check_interval_ms = 500

# optional: Maximum milliseconds to chase before giving up
max_chase_time_ms = 5000

# optional: Simulated fill latency for paper trading (ms)
paper_fill_latency_ms = 50

# optional: Order timeout before considering failed (ms)
order_timeout_ms = 10000

# optional: Fire a test trade on startup to verify connectivity
# Enable only after wallet is funded
test_trade_on_startup = false

# ============================================================================
# OPTIONAL SETTINGS - Have sensible defaults
# ============================================================================

[live]
# Minutes between auto-claim attempts for resolved positions
# Set to 0 to disable auto-claiming
auto_claim_interval = 15

[backtest]
# Optional: Start/end dates for backtesting (YYYY-MM-DD)
# If omitted, all data in data_dir is used
#start_date = "2026-01-26"
#end_date = "2026-01-27"

# Directory containing CSV data files
data_dir = "data/live_test_1"

# Decision log path for comparing live vs backtest behavior
# Logs all skip/execute decisions with full input state to CSV
#decision_log_path = "decisions_backtest.csv"

# Backtest-specific trading overrides
# Use different params for backtesting vs live
[backtest.trading]
available_balance = 1000.0
max_market_exposure = 250.0
max_total_exposure = 1000.0
base_order_size = 8.0

# ============================================================================
# ADVANCED SETTINGS - Rarely need to change
# ============================================================================

[trading.margins]
# Minimum profit margin in early phase (>5min remaining), %
min_margin_early_pct = 2.5

# Minimum profit margin in mid phase (2-5min remaining), %
min_margin_mid_pct = 1.5

# Minimum profit margin in late phase (<2min remaining), %
min_margin_late_pct = 0.5

# Seconds remaining to consider "early" phase
early_threshold_secs = 300

# Seconds remaining to consider "mid" phase
mid_threshold_secs = 120

# Don't trade if less than this many seconds remain
min_time_remaining_secs = 30

[risk.advanced]
# Risk evaluation mode: "arb", "directional", or "both"
risk_mode = "directional"

# Trip circuit breaker after this many consecutive failed orders
max_consecutive_failures = 3

# Seconds to wait after circuit breaker trips
circuit_breaker_cooldown_secs = 300

# Maximum YES/NO position imbalance ratio (0.0-1.0)
max_imbalance_ratio = 0.7

# Toxic flow detection threshold (0-100)
toxic_flow_threshold = 80

[backtest.advanced]
# Enable parameter sweep optimization
sweep_enabled = false

# Replay speed multiplier (0.0 = as fast as possible)
speed = 0.0

# Parallel workers for sweeps (0 = auto-detect CPU count)
sweep_parallel_workers = 8

[shadow]
# Enable shadow bids (backup orders on opposite leg)
enabled = true

# Price offset for shadow bids (basis points)
price_offset_bps = 50

# Max wait time for shadow bid confirmation (ms)
max_wait_ms = 2000

[engines]
# Engine priority order - first enabled engine wins
priority = ["directional", "arbitrage", "maker"]

[engines.arbitrage]
# Exploits YES + NO < $1.00 mispricings
# Usually disabled: taker fees exceed typical arb margins
enabled = false

# Minimum margin thresholds by phase (basis points)
min_margin_early_bps = 250  # 2.5%
min_margin_mid_bps = 150    # 1.5%
min_margin_late_bps = 50    # 0.5%

[engines.directional]
# Bets on price direction based on signals
enabled = true

# Don't trade if less than this many seconds remain
min_seconds_remaining = 60

# Maximum combined cost of YES + NO (1.02 = 2% max overpay)
max_combined_cost = 1.02

# Maximum bid-ask spread (basis points)
max_spread_bps = 1500

# Minimum depth on favorable side (USDC)
min_favorable_depth = 50.0

# ATR threshold for "strong" signal in late phase (bps)
strong_threshold_late_bps = 9

# ATR threshold for "lean" signal in late phase (bps)
lean_threshold_late_bps = 6

# Allocation ratios for signal strength
strong_up_ratio = 0.82  # Strong UP: 82% YES, 18% NO
lean_up_ratio = 0.65    # Lean UP: 65% YES, 35% NO
neutral_ratio = 0.50    # Neutral: 50/50

[engines.maker]
# Market making - provide liquidity, collect spread
# Usually disabled: requires careful inventory management
enabled = false

# Don't provide liquidity with less than this remaining (secs)
min_seconds_remaining = 120

# Minimum spread to capture (basis points)
min_spread_bps = 100

# Maximum spread - don't quote if wider than this (bps)
max_spread_bps = 1000

# Default order size for market making (USDC)
default_order_size = 50.0

[observability]
# Capture trading decisions to ClickHouse
capture_decisions = true

# Capture counterfactual analysis (what-if scenarios)
capture_counterfactuals = true

# Enable anomaly detection alerts
detect_anomalies = true

# Async channel buffer size for events
channel_buffer_size = 10000

# Batch size for database writes
batch_size = 1000

# Seconds between database flushes
flush_interval_secs = 5

# Enable alert notifications
alerts_enabled = false

[dashboard]
# Enable web dashboard
enabled = true

# WebSocket port for real-time updates
websocket_port = 3001

# REST API port for dashboard data
api_port = 3002

# Milliseconds between WebSocket broadcasts
broadcast_interval_ms = 500

# Seconds between P&L snapshots
pnl_snapshot_interval_secs = 10

# Channel capacity for dashboard events
channel_capacity = 10000

# Log when events are dropped due to full channel
log_drops = true

# Only log after this many consecutive drops
drop_log_threshold = 100

# Batch size for dashboard database writes
batch_size = 100

# Seconds between dashboard database flushes
flush_interval_secs = 5

# Maximum buffer size for dashboard events
max_buffer_size = 10000
