# Polymarket Arbitrage Bot Configuration
# ========================================
#
# Environment variables (set in .env or shell):
#   POLY_PRIVATE_KEY    - Wallet private key for signing transactions
#   POLY_API_KEY        - Polymarket API key
#   POLY_API_SECRET     - Polymarket API secret
#   POLY_API_PASSPHRASE - Polymarket API passphrase
#
# Usage:
#   cargo run -p poly-bot --release -- --mode paper
#   cargo run -p poly-bot --release -- --mode live

# ============================================================================
#                            USER SETTINGS
#                    (these are the ones you'll change)
# ============================================================================

[general]
mode = "live"                   # "paper", "live", or "backtest"
assets = ["BTC"]                # "BTC", "ETH", "SOL", "XRP"
window_duration = "15min"       # "15min" or "1h"
log_level = "info"              # "info", "debug", "trace"

[trading]
available_balance = 200.0       # Total capital for trading (USDC)
max_position_per_market = 50.0  # Max position size per market (USDC)
max_total_exposure = 50.0       # Max total exposure across all markets (USDC)
max_order_size = 0              # Max single order size (shares) - safety cap.
                                # Set to 0 to use market's min_order_size

# --- Margin thresholds (advanced) ---
min_margin_early_pct = 2.5      # Min margin in early phase (>5min), %
min_margin_mid_pct = 1.5        # Min margin in mid phase (2-5min), %
min_margin_late_pct = 0.5       # Min margin in late phase (<2min), %
early_threshold_secs = 300      # Seconds to consider "early" phase
mid_threshold_secs = 120        # Seconds to consider "mid" phase
min_time_remaining_secs = 30    # Don't trade below this

[risk]
max_daily_loss = 20.0           # Stop trading if daily loss exceeds (USDC)

# --- Advanced risk settings ---
risk_mode = "both"              # "arb", "directional", or "both"
max_consecutive_failures = 3    # Circuit breaker trip threshold
circuit_breaker_cooldown_secs = 300  # Cooldown after circuit breaker
max_imbalance_ratio = 0.7       # Max YES/NO imbalance (0.0-1.0)
toxic_flow_threshold = 80       # Toxic flow detection (0-100)
emergency_close_threshold = 200.0  # Emergency close above this (USDC)

[backtest]
start_date = "2026-01-08"       # Start date (YYYY-MM-DD)
end_date = "2026-01-15"         # End date (YYYY-MM-DD)
data_dir = "data/2026-01-08_2026-01-15_15min"  # CSV data directory

# --- Advanced backtest settings ---
sweep_enabled = false           # Enable parameter sweep
speed = 0.0                     # Replay speed (0 = max speed)
sweep_parallel_workers = 8      # Parallel workers (0 = auto)

# ============================================================================
#                          ADVANCED SETTINGS
#                      (rarely need to change these)
# ============================================================================

[execution]
execution_mode = "limit"        # "limit" (maker) or "market" (taker)
chase_enabled = true            # Enable price chasing for limit orders
chase_step_size = 0.01          # Price increment for chasing (tick size)
chase_check_interval_ms = 500   # Order status check interval (ms)
max_chase_time_ms = 30000       # Max chase duration (ms)
paper_fill_latency_ms = 50      # Simulated fill latency for paper (ms)
order_timeout_ms = 10000        # Order timeout (ms)
test_trade_on_startup = false   # Fire test trade on startup

[shadow]
enabled = true                  # Enable shadow bidding
price_offset_bps = 50           # Shadow bid price offset (basis points)
max_wait_ms = 2000              # Max wait for shadow confirmation (ms)

[engines]
priority = ["directional", "arbitrage", "maker"]  # Engine priority

[engines.arbitrage]
enabled = true                  # Enable arbitrage engine
min_margin_early_bps = 250      # Min margin early phase (bps)
min_margin_mid_bps = 150        # Min margin mid phase (bps)
min_margin_late_bps = 50        # Min margin late phase (bps)

[engines.directional]
enabled = true                  # Enable directional engine
min_seconds_remaining = 60      # Don't trade below this time
max_combined_cost = 1.02        # Max YES+NO cost (1.02 = 2% overpay)
max_spread_bps = 1500           # Max bid-ask spread (bps)
min_favorable_depth = 50.0      # Min depth on our side (USDC)
strong_threshold_late_bps = 9   # ATR multiplier for "strong" signal
lean_threshold_late_bps = 6     # ATR multiplier for "lean" signal
strong_up_ratio = 0.82          # Confidence ratio for strong UP
lean_up_ratio = 0.65            # Confidence ratio for lean UP
neutral_ratio = 0.50            # Confidence ratio for neutral
max_edge_factor = 0.01          # Max edge at window start (0.01 = 1% EV)

[engines.maker]
enabled = false                 # Enable market maker engine
min_seconds_remaining = 120     # Don't provide liquidity below this
min_spread_bps = 100            # Min spread to capture (bps)
max_spread_bps = 1000           # Max spread - don't quote wider
default_order_size = 50.0       # Default order size (USDC)

[observability]
capture_decisions = true        # Capture decisions to ClickHouse
capture_counterfactuals = true  # Capture what-if scenarios
detect_anomalies = true         # Enable anomaly detection
channel_buffer_size = 10000     # Async event buffer size
batch_size = 1000               # Database write batch size
flush_interval_secs = 5         # Database flush interval
alerts_enabled = false          # Enable alert notifications

[dashboard]
enabled = true                  # Enable web dashboard
websocket_port = 3001           # WebSocket port
api_port = 3002                 # REST API port
broadcast_interval_ms = 500     # WebSocket broadcast interval (ms)
pnl_snapshot_interval_secs = 10 # P&L snapshot interval
channel_capacity = 10000        # Dashboard event channel capacity
log_drops = true                # Log dropped events
drop_log_threshold = 100        # Log after this many drops
batch_size = 100                # Dashboard DB batch size
flush_interval_secs = 5         # Dashboard DB flush interval
max_buffer_size = 10000         # Max dashboard event buffer
