# Polymarket Arbitrage Bot Configuration
# ========================================
#
# Environment variables (set in .env or shell):
#   POLY_PRIVATE_KEY    - Wallet private key for signing transactions
#   POLY_API_KEY        - Polymarket API key
#   POLY_API_SECRET     - Polymarket API secret
#   POLY_API_PASSPHRASE - Polymarket API passphrase
#   CLICKHOUSE_URL      - ClickHouse HTTP URL
#   CLICKHOUSE_USER     - ClickHouse username
#   CLICKHOUSE_PASSWORD - ClickHouse password
#
# Usage:
#   cargo run -p poly-bot --release -- --mode paper

# ============================================================================
# USER SETTINGS (configure these)
# ============================================================================

[general]
mode = "paper"                    # paper, live, shadow, backtest
assets = ["BTC", "ETH", "SOL"]    # Assets to trade
log_level = "debug"               # info, debug, trace
window_duration = "15min"         # 15min or 1h

[trading]
# Position limits (USDC)
max_position_per_market = 1000.0
max_total_exposure = 5000.0
base_order_size = 75.0  # Increased to ensure min order size is met
# Defaults below
min_margin_early_pct = 2.5
min_margin_mid_pct = 1.5
min_margin_late_pct = 0.5
early_threshold_secs = 300
mid_threshold_secs = 120
min_time_remaining_secs = 30

[trading.sizing]
# Bot capital allocation (USDC)
# This is the amount allocated for the bot to trade with
available_balance = 100.0

[risk]
max_daily_loss = 500.0            # Stop trading if daily loss exceeds this
# Defaults below
risk_mode = "both"
max_consecutive_failures = 3
circuit_breaker_cooldown_secs = 300
max_imbalance_ratio = 0.7
toxic_flow_threshold = 80
emergency_close_threshold = 200.0

[backtest]
start_date = "2026-01-08"        # Backtest start date
end_date = "2026-01-15"          # Backtest end date
sweep_enabled = false
speed = 0.0
data_dir = "data/2026-01-08_2026-01-15_15min"  # CSV data directory
sweep_parallel_workers = 8  # or leave unset for auto-detect

# ============================================================================
# DEFAULTS (rarely need to change)
# ============================================================================

[shadow]
enabled = true
price_offset_bps = 50
max_wait_ms = 2000

[execution]
chase_enabled = true
chase_step_size = 0.001
chase_check_interval_ms = 100
max_chase_time_ms = 5000
paper_fill_latency_ms = 50
order_timeout_ms = 10000

[observability]
capture_decisions = true
capture_counterfactuals = true
detect_anomalies = true
channel_buffer_size = 10000
batch_size = 1000
flush_interval_secs = 5
alerts_enabled = false

[engines]
priority = ["directional", "arbitrage", "maker"]

[engines.arbitrage]
enabled = true
min_margin_early_bps = 250
min_margin_mid_bps = 150
min_margin_late_bps = 50

[engines.directional]
enabled = true
min_seconds_remaining = 60
max_combined_cost = 1.02
max_spread_bps = 1500
min_favorable_depth = 50.0
strong_threshold_late_bps = 9
lean_threshold_late_bps = 6
strong_up_ratio = 0.82
lean_up_ratio = 0.65
neutral_ratio = 0.50
max_edge_factor = 0.08  # 8% EV required at window start (sweep optimal)

[engines.maker]
enabled = false
min_seconds_remaining = 120
min_spread_bps = 100
max_spread_bps = 1000
default_order_size = 50.0

[dashboard]
enabled = true
websocket_port = 3001
api_port = 3002
broadcast_interval_ms = 500
pnl_snapshot_interval_secs = 10
channel_capacity = 10000
log_drops = true
drop_log_threshold = 100
batch_size = 100
flush_interval_secs = 5
max_buffer_size = 10000
