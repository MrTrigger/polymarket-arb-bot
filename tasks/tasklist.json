{
  "name": "React Trading Dashboard",
  "type": "feature",
  "created": "2026-01-15T12:00:00Z",
  "source": "tasks/prd-react-dashboard.md",
  "config": {
    "backend": "rust",
    "frontend": "bun",
    "infra": "none"
  },
  "tasks": [
    {
      "id": "phase1-schema",
      "title": "Phase 1: Add new ClickHouse table schemas",
      "description": "Add 5 new tables to schema.sql: sessions, bot_trades, pnl_snapshots, structured_logs, market_sessions. Follow existing patterns in the file.",
      "status": "completed",
      "depends": [],
      "files": ["crates/poly-common/src/schema.sql"],
      "acceptance": [
        "schema.sql contains CREATE TABLE for sessions",
        "schema.sql contains CREATE TABLE for bot_trades",
        "schema.sql contains CREATE TABLE for pnl_snapshots",
        "schema.sql contains CREATE TABLE for structured_logs",
        "schema.sql contains CREATE TABLE for market_sessions"
      ],
      "us": ["US-019", "US-020", "US-021", "US-022", "US-023"]
    },
    {
      "id": "phase1-types",
      "title": "Phase 1: Create dashboard event types",
      "description": "Create types for dashboard events: SessionRecord, TradeRecord, PnlSnapshot, LogEntry, MarketSessionUpdate. Use rust_decimal for money, UUID for IDs. Add serde + clickhouse derives.",
      "status": "completed",
      "depends": ["phase1-schema"],
      "files": ["crates/poly-bot/src/dashboard/types.rs"],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "All types derive Serialize, Deserialize",
        "All types derive clickhouse::Row where needed"
      ],
      "us": ["US-019", "US-020", "US-021", "US-022", "US-023"]
    },
    {
      "id": "phase1-capture",
      "title": "Phase 1: Implement DashboardCapture channel",
      "description": "Create fire-and-forget capture system following observability/capture.rs pattern. Bounded channel with try_send(), DashboardEvent enum, CaptureStats for monitoring. Must not block hot path.",
      "status": "completed",
      "depends": ["phase1-types"],
      "files": ["crates/poly-bot/src/dashboard/capture.rs"],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "try_send() pattern used (no blocking)",
        "Drops on backpressure"
      ],
      "us": ["US-024"]
    },
    {
      "id": "phase1-processor",
      "title": "Phase 1: Implement dashboard event processor",
      "description": "Background processor that receives DashboardEvents and writes to ClickHouse. Batch inserts for efficiency. Graceful shutdown handling.",
      "status": "completed",
      "depends": ["phase1-capture"],
      "files": ["crates/poly-bot/src/dashboard/processor.rs"],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "Writes to all 5 new tables",
        "Handles shutdown signal"
      ],
      "us": ["US-024"]
    },
    {
      "id": "phase1-session",
      "title": "Phase 1: Implement session lifecycle management",
      "description": "Create/update session records on bot start/stop. Generate session UUID, compute config hash, track exit reason. Integrate with existing mode startup.",
      "status": "completed",
      "depends": ["phase1-processor"],
      "files": [
        "crates/poly-bot/src/dashboard/session.rs",
        "crates/poly-bot/src/mode/live.rs",
        "crates/poly-bot/src/mode/paper.rs"
      ],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "Session created on startup",
        "Session updated on shutdown"
      ],
      "us": ["US-019"]
    },
    {
      "id": "phase1-mod",
      "title": "Phase 1: Create dashboard module structure",
      "description": "Create mod.rs exporting all dashboard submodules. Add dashboard feature flag to Cargo.toml. Add DashboardConfig to config.rs.",
      "status": "pending",
      "depends": ["phase1-session"],
      "files": [
        "crates/poly-bot/src/dashboard/mod.rs",
        "crates/poly-bot/Cargo.toml",
        "crates/poly-bot/src/config.rs",
        "crates/poly-bot/src/lib.rs"
      ],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo build -p poly-bot passes",
        "DashboardConfig in config.rs"
      ],
      "us": ["US-024"]
    },
    {
      "id": "phase2-state",
      "title": "Phase 2: Create DashboardState struct",
      "description": "Aggregate struct containing: MetricsSnapshot, active markets, recent trades, order book summaries, positions, control flags, logs, anomalies. Lock-free snapshot creation from GlobalState DashMaps.",
      "status": "pending",
      "depends": ["phase1-mod"],
      "files": ["crates/poly-bot/src/dashboard/state.rs"],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "Serializes to JSON",
        "No mutex locks in snapshot()"
      ],
      "us": ["US-017"]
    },
    {
      "id": "phase2-ws-server",
      "title": "Phase 2: Implement WebSocket server",
      "description": "tokio-tungstenite WebSocket server on configurable port. Broadcasts DashboardState at interval. Handles multiple clients. Sends full snapshot on connect.",
      "status": "pending",
      "depends": ["phase2-state"],
      "files": ["crates/poly-bot/src/dashboard/server.rs"],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "WebSocket accepts connections",
        "Broadcasts state at configured interval"
      ],
      "us": ["US-001", "US-018"]
    },
    {
      "id": "phase2-rest-api",
      "title": "Phase 2: Implement REST API endpoints",
      "description": "axum HTTP server with endpoints: GET /api/sessions, /api/sessions/:id/equity, /api/sessions/:id/trades, /api/sessions/:id/logs (paginated), /api/sessions/:id/markets. Query ClickHouse, return JSON.",
      "status": "pending",
      "depends": ["phase2-ws-server"],
      "files": ["crates/poly-bot/src/dashboard/api.rs"],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "All 5 endpoints return JSON",
        "Pagination works for logs"
      ],
      "us": ["US-025"]
    },
    {
      "id": "phase2-integration",
      "title": "Phase 2: Integrate dashboard with bot startup",
      "description": "Start dashboard server in bot main(). Wire capture channel to executor for trade events. Add PnL snapshot timer. Wire to tracing for log capture.",
      "status": "pending",
      "depends": ["phase2-rest-api"],
      "files": [
        "crates/poly-bot/src/main.rs",
        "crates/poly-bot/src/executor.rs"
      ],
      "acceptance": [
        "cargo clippy -p poly-bot -- -D warnings passes",
        "cargo test -p poly-bot passes",
        "Dashboard starts with bot",
        "Trade events captured"
      ],
      "us": ["US-001", "US-021", "US-022"]
    },
    {
      "id": "phase3-scaffold",
      "title": "Phase 3: Scaffold frontend project",
      "description": "Create frontend/ directory. Initialize with bun create vite. Add TypeScript, React, TailwindCSS. Configure path aliases. Add shadcn/ui. Install lightweight-charts, zustand, react-query, react-router-dom.",
      "status": "pending",
      "depends": [],
      "files": [
        "frontend/package.json",
        "frontend/vite.config.ts",
        "frontend/tsconfig.json",
        "frontend/tailwind.config.js",
        "frontend/components.json"
      ],
      "acceptance": [
        "bun install succeeds",
        "bun run dev starts server",
        "bun run typecheck passes",
        "bun run build produces dist/"
      ],
      "us": ["US-002"]
    },
    {
      "id": "phase3-types",
      "title": "Phase 3: Create TypeScript types",
      "description": "Create types.ts matching Rust structs: DashboardSnapshot, MetricsSnapshot, ActiveMarket, Position, Trade, LogEntry, Anomaly, ControlState, EquityPoint.",
      "status": "pending",
      "depends": ["phase3-scaffold"],
      "files": ["frontend/src/lib/types.ts"],
      "acceptance": [
        "bun run typecheck passes",
        "Types match Rust serialization"
      ],
      "us": ["US-017"]
    },
    {
      "id": "phase3-websocket",
      "title": "Phase 3: Implement WebSocket hook",
      "description": "Create useWebSocket hook with: connect to configurable URL, auto-reconnect with exponential backoff, parse JSON, expose connection status, handle errors gracefully.",
      "status": "pending",
      "depends": ["phase3-types"],
      "files": ["frontend/src/hooks/useWebSocket.ts"],
      "acceptance": [
        "bun run typecheck passes",
        "Connects to ws://localhost:3001",
        "Reconnects on disconnect"
      ],
      "us": ["US-003"]
    },
    {
      "id": "phase3-store",
      "title": "Phase 3: Create dashboard state store",
      "description": "Zustand store for dashboard state. Update from WebSocket messages. Selectors for metrics, markets, trades, logs. useDashboardState hook.",
      "status": "pending",
      "depends": ["phase3-websocket"],
      "files": [
        "frontend/src/hooks/useDashboardState.ts",
        "frontend/src/lib/store.ts"
      ],
      "acceptance": [
        "bun run typecheck passes",
        "State updates from WebSocket"
      ],
      "us": ["US-003"]
    },
    {
      "id": "phase3-layout",
      "title": "Phase 3: Create app layout and routing",
      "description": "Create App.tsx with React Router. Routes: / (Dashboard), /market/:eventId (MarketDetail). Header with connection status. Dark theme wrapper.",
      "status": "pending",
      "depends": ["phase3-store"],
      "files": [
        "frontend/src/App.tsx",
        "frontend/src/main.tsx",
        "frontend/src/pages/Dashboard.tsx",
        "frontend/src/pages/MarketDetail.tsx"
      ],
      "acceptance": [
        "bun run typecheck passes",
        "Routes work",
        "Header shows connection status"
      ],
      "us": ["US-003", "US-015"]
    },
    {
      "id": "phase4-metrics",
      "title": "Phase 4: Create MetricsCards component",
      "description": "Display P&L, volume, trades executed/failed/skipped, win rate, exposure. Use shadcn Card. Color P&L green/red. Update in real-time.",
      "status": "pending",
      "depends": ["phase3-layout"],
      "files": ["frontend/src/components/dashboard/MetricsCards.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Shows all metrics",
        "P&L colored correctly"
      ],
      "us": ["US-004"]
    },
    {
      "id": "phase4-equity",
      "title": "Phase 4: Create EquityCurve chart",
      "description": "Lightweight Charts line chart for cumulative P&L. Dark theme. Time on X-axis, USDC on Y. Crosshair with values. Auto-scale. Real-time updates.",
      "status": "pending",
      "depends": ["phase4-metrics"],
      "files": ["frontend/src/components/dashboard/EquityCurve.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Chart renders",
        "Updates in real-time"
      ],
      "us": ["US-005"]
    },
    {
      "id": "phase4-markets",
      "title": "Phase 4: Create MarketsGrid component",
      "description": "Table of active markets. Columns: asset, strike, time remaining, spot price, YES/NO bid/ask, arb spread, position. Clickable rows navigate to /market/:eventId. Highlight arb opportunities.",
      "status": "pending",
      "depends": ["phase4-equity"],
      "files": ["frontend/src/components/dashboard/MarketsGrid.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Shows all markets",
        "Rows clickable",
        "Arb highlighted"
      ],
      "us": ["US-006"]
    },
    {
      "id": "phase4-circuit",
      "title": "Phase 4: Create CircuitBreakerStatus component",
      "description": "Status indicator: green=enabled, yellow=disabled, red=tripped. Show failure count. Show cooldown remaining if tripped.",
      "status": "pending",
      "depends": ["phase4-markets"],
      "files": ["frontend/src/components/dashboard/CircuitBreakerStatus.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Shows correct status",
        "Colors correct"
      ],
      "us": ["US-007"]
    },
    {
      "id": "phase4-logs",
      "title": "Phase 4: Create LogWindow component",
      "description": "Collapsible panel showing last 100 logs. Color by level: ERROR=red, WARN=yellow, INFO=white, DEBUG=gray. Auto-scroll. Filter by level. Text search.",
      "status": "pending",
      "depends": ["phase4-circuit"],
      "files": ["frontend/src/components/dashboard/LogWindow.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Shows logs",
        "Filter works",
        "Auto-scrolls"
      ],
      "us": ["US-012"]
    },
    {
      "id": "phase4-dashboard",
      "title": "Phase 4: Assemble Dashboard page",
      "description": "Compose Dashboard.tsx from MetricsCards, EquityCurve, MarketsGrid, CircuitBreakerStatus, LogWindow. Grid layout, desktop-optimized.",
      "status": "pending",
      "depends": ["phase4-logs"],
      "files": ["frontend/src/pages/Dashboard.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "All components visible",
        "Layout looks good"
      ],
      "us": ["US-004", "US-005", "US-006", "US-007", "US-012"]
    },
    {
      "id": "phase5-price-chart",
      "title": "Phase 5: Create PriceChart component",
      "description": "Lightweight Charts for spot price history. Strike price as horizontal line. Trade markers: green triangles=buy, red=sell. Different markers for YES/NO. Window boundaries visible.",
      "status": "pending",
      "depends": ["phase4-dashboard"],
      "files": ["frontend/src/components/market/PriceChart.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Chart renders",
        "Trade markers show",
        "Strike line visible"
      ],
      "us": ["US-008"]
    },
    {
      "id": "phase5-orderbook",
      "title": "Phase 5: Create OrderBookDisplay component",
      "description": "Show YES and NO order books side by side. Bid/ask with sizes. Spread for each. Combined arb calculation: YES_ask + NO_ask vs $1.00. Highlight when arb exists.",
      "status": "pending",
      "depends": ["phase5-price-chart"],
      "files": ["frontend/src/components/market/OrderBookDisplay.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Both books show",
        "Arb calculation shown"
      ],
      "us": ["US-009"]
    },
    {
      "id": "phase5-position",
      "title": "Phase 5: Create PositionPanel component",
      "description": "Show YES/NO shares and cost basis. Imbalance ratio and inventory state badge. Realized and unrealized P&L for this market.",
      "status": "pending",
      "depends": ["phase5-orderbook"],
      "files": ["frontend/src/components/market/PositionPanel.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Position shows",
        "P&L calculated"
      ],
      "us": ["US-010"]
    },
    {
      "id": "phase5-trades",
      "title": "Phase 5: Create TradesTable component",
      "description": "Table of trades for this market. Columns: time, side, action, price, size, P&L. Sorted by time desc. Color by profit/loss. Virtualized for performance.",
      "status": "pending",
      "depends": ["phase5-position"],
      "files": ["frontend/src/components/market/TradesTable.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Trades show",
        "Colors correct"
      ],
      "us": ["US-011"]
    },
    {
      "id": "phase5-market-page",
      "title": "Phase 5: Assemble MarketDetail page",
      "description": "Compose MarketDetail.tsx from PriceChart, OrderBookDisplay, PositionPanel, TradesTable. Get eventId from URL params. Fetch market-specific data.",
      "status": "pending",
      "depends": ["phase5-trades"],
      "files": ["frontend/src/pages/MarketDetail.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "All components visible",
        "eventId from URL works"
      ],
      "us": ["US-008", "US-009", "US-010", "US-011"]
    },
    {
      "id": "phase6-session-metrics",
      "title": "Phase 6: Create SessionMetrics panel",
      "description": "Panel showing: session start/duration, events processed, opportunities detected, trade rate, avg trade size, shadow order ratio. Real-time updates.",
      "status": "pending",
      "depends": ["phase5-market-page"],
      "files": ["frontend/src/components/dashboard/SessionMetrics.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "All stats show",
        "Updates in real-time"
      ],
      "us": ["US-013"]
    },
    {
      "id": "phase6-anomalies",
      "title": "Phase 6: Create AnomalyAlerts component",
      "description": "Alert banner when anomaly detected. Type, severity, message. Dismissable. Alert history. Critical anomalies highlighted.",
      "status": "pending",
      "depends": ["phase6-session-metrics"],
      "files": ["frontend/src/components/dashboard/AnomalyAlerts.tsx"],
      "acceptance": [
        "bun run typecheck passes",
        "Alerts show",
        "Dismissable"
      ],
      "us": ["US-014"]
    },
    {
      "id": "phase6-theme",
      "title": "Phase 6: Finalize dark theme",
      "description": "Ensure dark theme throughout. Configure Lightweight Charts dark theme. Verify all shadcn components use dark mode. No bright flashes.",
      "status": "pending",
      "depends": ["phase6-anomalies"],
      "files": [
        "frontend/src/index.css",
        "frontend/tailwind.config.js"
      ],
      "acceptance": [
        "bun run typecheck passes",
        "All dark theme",
        "Charts dark"
      ],
      "us": ["US-015"]
    },
    {
      "id": "phase6-build",
      "title": "Phase 6: Configure production build",
      "description": "Verify bun run build produces optimized dist/. Assets hashed. Optionally serve from poly-bot with tower-http static files.",
      "status": "pending",
      "depends": ["phase6-theme"],
      "files": [
        "frontend/vite.config.ts",
        "crates/poly-bot/src/dashboard/server.rs"
      ],
      "acceptance": [
        "bun run build succeeds",
        "dist/ contains hashed assets",
        "poly-bot can serve static files"
      ],
      "us": ["US-016"]
    },
    {
      "id": "phase6-final",
      "title": "Phase 6: Final integration test",
      "description": "Run poly-bot in paper mode with dashboard. Verify all components work. Test WebSocket reconnection. Test REST API queries. Document any issues.",
      "status": "pending",
      "depends": ["phase6-build"],
      "files": [],
      "acceptance": [
        "Dashboard connects and shows data",
        "All charts render",
        "Market detail works",
        "Logs stream",
        "No console errors"
      ],
      "us": ["US-001", "US-002", "US-003"]
    }
  ]
}
